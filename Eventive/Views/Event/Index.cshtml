@using System.Configuration;
@using Eventive.Models.Events;
@model EventListViewModel;
@{
    ViewData["Title"] = "Events";
}

<div class="d-flex justify-content-around m-xl-5">
    <input id="searchTitleBar" class="form-control search-bar col-3 mr-4" type="text" placeholder="Search by name" aria-label="Search">
    <input id="searchLocationBar" class="form-control search-bar col-3 mr-4" type="text" placeholder="Search by location" aria-label="Search">

    @if (User.Identity.IsAuthenticated)
    {
        <div>
            <button class="btn createButton ml-3" data-toggle="modal" data-target="#newEventModal">Create</button>
        </div>
    }
</div>

<div class="container">
    <ul class="nav nav-pills nav-justified">
        <li class="nav-item">
            <a class="nav-link active" data-toggle="pill" onclick="searchByCategory('')">All</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="pill" onclick="searchByCategory('Entertainment')">Entertainment</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="pill" onclick="searchByCategory('Education')">Education</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="pill" onclick="searchByCategory('Hangout')">Hangout</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="pill" onclick="searchByCategory('Networking')">Networking</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="pill" onclick="searchByCategory('Other')">Other</a>
        </li>
    </ul>
</div>

<hr />

<div id="eventContainer"></div>

@section Scripts {
    @{
        string apiKey = ConfigurationManager.AppSettings.Get("GOOGLE_API_KEY");
        string scriptUrl = string.Format("https://maps.googleapis.com/maps/api/js?key={0}&libraries=places", apiKey);

        <script src="@scriptUrl"></script>
    }

    <partial name="_ScriptsPartial" />
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
            loadEvents();
        });

        function loadEvents() {
            loadServerPartialView("#eventContainer", '@Url.Action("EventContainer", "Event")');
        }

        function modalFormComplete(modalName) {
            $(modalName).modal("hide");
            loadEvents();
            initializeGoogleApi();
        }

        function initializeGoogleApi() {
            document.getElementById('cityLat').value = null;
            document.getElementById('cityLong').value = null;
            document.getElementById('isLocationValid').value = false;

            var input = document.getElementById('locationInput');
            var autocomplete = new google.maps.places.Autocomplete(input);

            google.maps.event.addListener(autocomplete, 'place_changed', function () {
                document.getElementById('isLocationValid').value = true;
                var place = autocomplete.getPlace();
                document.getElementById('cityLat').value = place.geometry.location.lat();
                document.getElementById('cityLong').value = place.geometry.location.lng();
            });
        }

        google.maps.event.addDomListener(window, 'load', initializeGoogleApi);

        $("#locationInput").keydown(function () {
            document.getElementById('isLocationValid').value = false;
        });
    </script>
}